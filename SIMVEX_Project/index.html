<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMVEX 3D Viewer</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #111; }
        canvas { display: block; }
    </style>
</head>
<body>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Scene (무대)
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xD2D2D2);

        // 2. Camera (눈)
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(-0.2, 0.3, 1);

        // 3. Renderer (그리기 장치)
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 4. Lighting (조명) - 모델이 보이려면 필수!
        const ambientLight = new THREE.AmbientLight(0xffffff, 1); // 전체적인 밝기
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 2); // 태양광 같은 직사광선
        dirLight.position.set(5, 5, 5);
        scene.add(dirLight);

        // 5. Controls (마우스 조작)
        const controls = new OrbitControls(camera, renderer.domElement);

// 6. JSON 데이터를 기반으로 모든 모델 자동 로드
async function loadModelsFromJSON() {
    try {
        const response = await fetch('./3D_data.json'); // JSON 파일 가져오기
        const data = await response.json();
        const { base_path, assets } = data;

        const loader = new GLTFLoader();

        assets.forEach((asset) => {
            const fullPath = base_path + asset.filename;

            loader.load(
                fullPath,
                (gltf) => {
                    const model = gltf.scene;
                    
                    // 1. JSON에 적힌 포지션 설정
                    model.position.set(asset.position.x, asset.position.y, asset.position.z);
                    
                    // 2. JSON에 적힌 벡터값을 회전(Rotation)으로 적용
                    // (라디안 단위로 변환이 필요할 수 있습니다: Degree * Math.PI / 180)
                    model.rotation.set(asset.vector.x, asset.vector.y, asset.vector.z);
                    
                    // 3. 나중에 제어하기 위해 데이터 심어두기
                    model.name = asset.id;
                    model.userData.group = asset.group_name;

                    scene.add(model);
                    console.log(`성공: ${asset.filename}`);
                },
                (xhr) => {
                    // 개별 파일 로딩 진행률 (필요시 사용)
                },
                (error) => {
                    console.error(`실패: ${fullPath}`, error);
                }
            );
        });
    } catch (error) {
        console.error('JSON 파일을 읽지 못했습니다:', error);
    }
}

// 함수 호출
loadModelsFromJSON();

        // 7. 애니메이션 루프 (매 프레임 화면을 새로 그림)
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // 윈도우 리사이즈 대응
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>